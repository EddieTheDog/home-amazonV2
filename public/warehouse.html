<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Warehouse - Laptop</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h1 { color: #333; }
label { display: block; margin: 8px 0; }
input { padding: 5px; width: 250px; margin-bottom: 5px; }
button { padding: 6px 12px; margin-right: 5px; margin-top: 10px; }
#status { margin-top: 10px; font-weight: bold; }
#scans { background: #f5f5f5; padding: 10px; margin-top: 20px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; }
</style>
</head>
<body>
<h1>Warehouse - Laptop</h1>

<label>Session ID: <input type="text" id="sessionKey"></label>
<label>Employee Name: <input type="text" id="employee"></label>
<label>Location: <input type="text" id="location"></label>
<button id="startSession">Start Session</button>
<button id="endSession">End Session</button>

<div id="status">No active session</div>
<h2>Scanned Packages</h2>
<div id="scans">Waiting for scans...</div>

<script>
let sessionActive = false;
let sessionKey = null;
let scanInterval = null;

document.getElementById('startSession').addEventListener('click', async () => {
  sessionKey = document.getElementById('sessionKey').value.trim();
  const employee = document.getElementById('employee').value.trim();
  const location = document.getElementById('location').value.trim();
  if(!sessionKey || !employee || !location) return alert("Fill all fields");

  try {
    const res = await fetch('/api/session/start', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ sessionKey, employee, location })
    });
    const data = await res.json();
    if(res.ok){
      sessionActive = true;
      document.getElementById('status').textContent = `Session ${sessionKey} started`;
      document.getElementById('scans').textContent = "Waiting for scans...";

      scanInterval = setInterval(async () => {
        const response = await fetch(`/api/session/${sessionKey}/scans`);
        const scans = await response.json();
        document.getElementById('scans').textContent = JSON.stringify(scans, null, 2);
      }, 2000);
    } else alert(data.error);
  } catch(e){ alert(e.message); }
});

document.getElementById('endSession').addEventListener('click', async () => {
  if(!sessionActive) return;
  try {
    await fetch('/api/session/end', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ sessionKey })
    });
    sessionActive = false;
    clearInterval(scanInterval);
    document.getElementById('status').textContent = `Session ${sessionKey} ended`;
    document.getElementById('scans').textContent += "\nSession ended.";
  } catch(e){ alert(e.message); }
});
</script>
</body>
</html>
