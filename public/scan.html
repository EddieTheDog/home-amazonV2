<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Warehouse Scanner</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
h1 { color: #333; }
label { display: block; margin: 8px 0; }
input { padding: 5px; width: 250px; margin-bottom: 5px; }
button { padding: 6px 12px; margin-top: 10px; margin-right: 5px; }
#status { margin-top: 10px; font-weight: bold; }
</style>
</head>
<body>
<h1>Warehouse Scanner</h1>

<label>Session Key: <input type="text" id="sessionKey"></label>
<button id="connectSession">Connect Session</button>
<div id="status">Not connected</div>

<label>Scan Barcode:</label>
<input type="text" id="barcodeInput" placeholder="Scan barcode here" disabled>
<button id="sendScan" disabled>Send Scan</button>

<script>
let sessionConnected = false;
let sessionKey = null;

// Connect to session
document.getElementById('connectSession').addEventListener('click', () => {
  sessionKey = document.getElementById('sessionKey').value.trim();
  if (!sessionKey) return alert("Enter a session key");
  sessionConnected = true;
  document.getElementById('status').textContent = `Connected to session ${sessionKey}`;
  document.getElementById('barcodeInput').disabled = false;
  document.getElementById('sendScan').disabled = false;
});

// Send scan to warehouse
document.getElementById('sendScan').addEventListener('click', async () => {
  if (!sessionConnected) return alert("Connect to a session first");

  const barcode = document.getElementById('barcodeInput').value.trim();
  if (!barcode) return alert("Scan a barcode");

  // Send to server (updates warehouse package)
  const res = await fetch('/api/package/scan', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      sessionKey,
      barcode,
      action: 'scanned',
      location: 'Phone Scanner',
      employee: 'Scanner Device'
    })
  });

  const data = await res.json();
  if (data.error) {
    alert(`Error: ${data.error}`);
  } else {
    alert(`Scanned successfully!\nStatus: ${data.package.currentPublicStatus}`);
    // Trigger a custom event for the laptop warehouse page
    window.dispatchEvent(new CustomEvent('packageScanned', { detail: { barcode } }));
  }

  // Clear input for next scan
  document.getElementById('barcodeInput').value = '';
  document.getElementById('barcodeInput').focus();
});
</script>
</body>
</html>
