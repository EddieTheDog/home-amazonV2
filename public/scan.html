<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scanner Device</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
input, button { margin: 5px; padding: 5px; }
#status { font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>
<h1>Scanner Device</h1>

<label>Session Key: <input type="text" id="sessionKey"></label>
<label>Device Name: <input type="text" id="deviceName"></label>
<button id="joinQueue">Join Queue</button>
<div id="status">Not connected</div>

<label>Scan Barcode:</label>
<input type="text" id="barcodeInput" placeholder="Scan barcode here" disabled>
<button id="sendScan" disabled>Send Scan</button>

<script>
let sessionConnected = false;
let sessionKey = null;

document.getElementById('joinQueue').addEventListener('click', async () => {
  sessionKey = document.getElementById('sessionKey').value.trim();
  const deviceName = document.getElementById('deviceName').value.trim();
  if(!sessionKey || !deviceName) return alert("Fill both fields");

  const res = await fetch('/api/session/join', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({ sessionKey, deviceName })
  });
  const data = await res.json();
  if(res.ok) {
    document.getElementById('status').textContent = `Queued: ${deviceName}. Waiting for laptop to connect...`;
    alert("Queued. Wait for laptop confirmation.");
    document.getElementById('barcodeInput').disabled = false;
    document.getElementById('sendScan').disabled = false;
  } else alert(data.error);
});

document.getElementById('sendScan').addEventListener('click', () => {
  if(!sessionKey) return alert("Not connected to session");
  const barcode = document.getElementById('barcodeInput').value.trim();
  if(!barcode) return alert("Scan a barcode");
  window.dispatchEvent(new CustomEvent('packageScanned', { detail: { barcode } }));
  document.getElementById('barcodeInput').value = '';
});
</script>
</body>
</html>
