<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scanner</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button { margin: 5px; padding: 8px; }
    #status { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Scanner - Phone/Device</h1>

  <label>Session Key: <input type="text" id="sessionKey" placeholder="A1"></label>
  <label>Device Name: <input type="text" id="deviceName" placeholder="Phone 1"></label>
  <button id="connectBtn">Connect</button>

  <div id="status">Not connected.</div>
  <div>
    <input type="text" id="barcodeInput" placeholder="Scan or type barcode" autofocus>
    <button id="sendBtn">Send Scan</button>
  </div>

  <script>
    let connected = false;

    document.getElementById('connectBtn').addEventListener('click', () => {
      const sessionKey = document.getElementById('sessionKey').value.trim();
      const deviceName = document.getElementById('deviceName').value.trim();
      if(!sessionKey || !deviceName) return alert('Enter session key and device name!');
      connected = true;
      document.getElementById('status').textContent = `Connected to session ${sessionKey}`;
    });

    document.getElementById('sendBtn').addEventListener('click', async () => {
      if(!connected) return alert('Not connected!');
      const barcode = document.getElementById('barcodeInput').value.trim();
      const sessionKey = document.getElementById('sessionKey').value.trim();
      const deviceName = document.getElementById('deviceName').value.trim();
      if(!barcode) return alert('Scan a barcode first!');

      try {
        const res = await fetch('/api/package/scan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            sessionKey,
            barcode,
            action: 'Scanned',
            location: 'Warehouse',
            employee: deviceName
          })
        });
        const data = await res.json();
        if(data.error) alert('Error: ' + data.error);
        else document.getElementById('status').textContent = `Sent: ${barcode}`;
        document.getElementById('barcodeInput').value = '';
      } catch(err) {
        alert('Error sending scan.');
      }
    });
  </script>
</body>
</html>
