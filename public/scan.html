<h1>Warehouse - Phone Scan</h1>

<label>Session ID: <input type="text" id="sessionKey"></label>
<button id="connectSession">Connect Session</button>
<div id="status">Not connected</div>
<div id="reader"></div>
<div id="result"></div>

<script>
let sessionKey = null;
let connected = false;

document.getElementById('connectSession').addEventListener('click', () => {
  sessionKey = document.getElementById('sessionKey').value.trim();
  if(!sessionKey) return alert("Enter a session ID");
  connected = true;
  document.getElementById('status').textContent = `Connected to session ${sessionKey}`;

  new Html5Qrcode("reader").start(
    { facingMode: "environment" },
    { fps: 10, qrbox: 250 },
    decodedText => {
      if(!connected) return;
      fetch('/api/package/scan', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          sessionKey,
          barcode: decodedText,
          action: 'scanned',
          location: 'Warehouse Scan',
          employee: 'Phone Scanner'
        })
      })
      .then(res => res.json())
      .then(json => {
        const resultEl = document.getElementById('result');
        resultEl.textContent = `Scanned: ${decodedText}\nStatus: ${json.package?.currentPublicStatus || 'Error'}\n` + resultEl.textContent;
      });
    }
  );
});
</script>
